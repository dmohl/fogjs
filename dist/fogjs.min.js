/*! fogjs 30-09-2013 */
var q=require("q"),azure=require("azure"),exports={},defaultBlobService=azure.createBlobService();exports.createContainerIfNotExists=function(a,b,c){var d=q.defer(),e=function(a,b,c){if(a)d.reject(new Error(a));else{var e={containerCreated:b,response:c};d.resolve(e)}};return c?a.createContainerIfNotExists(b,c,e):a.createContainerIfNotExists(b,e),d.promise},exports.createBlockBlobFromText=function(a,b,c,d,e){var f=q.defer(),g=function(a,b,c){if(a)f.reject(new Error(a));else{var d={blockBlob:b,response:c};f.resolve(d)}},h=function(a){e?a.createBlockBlobFromText(b,c,d,e,g):a.createBlockBlobFromText(b,c,d,g)};return a&&a.containerName?(b=a.containerName,c=a.blobName,d=a.blobText,e=a.options,defaultBlobService.createContainerIfNotExists(b,{publicAccessLevel:"blob"},function(){h(defaultBlobService)})):h(a),f.promise},exports.createBlockBlobFromFile=function(a,b,c,d,e){var f=q.defer(),g=function(a,b,c){if(a)f.reject(new Error(a));else{var d={blockBlob:b,response:c};f.resolve(d)}},h=function(a){e?a.createBlockBlobFromFile(b,c,d,e,g):a.createBlockBlobFromFile(b,c,d,g)};return a&&a.containerName?(b=a.containerName,c=a.blobName,d=a.fileName,e=a.options,exports.createContainerIfNotExists(defaultBlobService,b,{publicAccessLevel:"blob"}).then(function(){h(defaultBlobService)})):h(a),f.promise},exports.createBlockBlobFromStream=function(a,b,c,d,e,f){var g=q.defer(),h=function(a,b,c){if(a)g.reject(new Error(a));else{var d={blockBlob:b,response:c};g.resolve(d)}},i=function(a){f?a.createBlockBlobFromStream(b,c,d,e,f,h):a.createBlockBlobFromStream(b,c,d,e,h)};return a&&a.containerName?(b=a.containerName,c=a.blobName,d=a.stream,e=a.streamLength,f=a.options,exports.createContainerIfNotExists(defaultBlobService,b,{publicAccessLevel:"blob"}).then(function(){i(defaultBlobService)})):i(a),g.promise},exports.deleteContainer=function(a,b,c){var d=q.defer(),e=function(a,b){a?d.reject(new Error(a)):d.resolve(b)};return c?a.deleteContainer(b,c,e):a.deleteContainer(b,e),d.promise},exports.getBlobToText=function(a,b,c,d){var e=q.defer(),f=function(a,b,c,d){if(a)e.reject(new Error(a));else{var f={text:b,blockBlob:c,response:d};e.resolve(f)}},g=function(a){d?a.getBlobToText(b,c,d,f):a.getBlobToText(b,c,f)};return a&&a.containerName?(b=a.containerName,c=a.blobName,d=a.options,defaultBlobService.createContainerIfNotExists(b,{publicAccessLevel:"blob"},function(){g(defaultBlobService)})):g(a),e.promise},exports.getBlobToFile=function(a,b,c,d,e){var f=q.defer(),g=function(a,b,c){if(a)f.reject(new Error(a));else{var d={blockBlob:b,response:c};f.resolve(d)}},h=function(a){e?a.getBlobToFile(b,c,d,e,g):a.getBlobToFile(b,c,d,g)};return a&&a.containerName?(b=a.containerName,c=a.blobName,d=a.fileName,e=a.options,exports.createContainerIfNotExists(defaultBlobService,b,{publicAccessLevel:"blob"}).then(function(){h(defaultBlobService)})):h(a),f.promise},exports.getBlobToStream=function(a,b,c,d,e){var f=q.defer(),g=function(a,b,c){if(a)f.reject(new Error(a));else{var d={blockBlob:b,response:c};f.resolve(d)}},h=function(a){e?a.getBlobToStream(b,c,d,e,g):a.getBlobToStream(b,c,d,g)};return a&&a.containerName?(b=a.containerName,c=a.blobName,d=a.writeStream,e=a.options,exports.createContainerIfNotExists(defaultBlobService,b,{publicAccessLevel:"blob"}).then(function(){h(defaultBlobService)})):h(a),f.promise},exports.deleteBlob=function(a,b,c,d){var e=q.defer(),f=function(a,b,c){if(a)e.reject(new Error(a));else{var d={isSuccessful:b,response:c};e.resolve(d)}},g=function(a){d?a.deleteBlob(b,c,d,f):a.deleteBlob(b,c,f)};return a&&a.containerName?(b=a.containerName,c=a.blobName,d=a.options,exports.createContainerIfNotExists(defaultBlobService,b,{publicAccessLevel:"blob"}).then(function(){g(defaultBlobService)})):g(a),e.promise},module.exports=exports;