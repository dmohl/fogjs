var q=require("q"),azure=require("azure"),exports={},cachedDefaultBlobService,defaultBlobService=function(){return cachedDefaultBlobService||(cachedDefaultBlobService=azure.createBlobService()),cachedDefaultBlobService};exports.createContainerIfNotExists=function(e,o,r){var t=q.defer(),n=function(e,o,r){if(e)t.reject(Error(e));else{var n={containerCreated:o,response:r};t.resolve(n)}};return r?e.createContainerIfNotExists(o,r,n):e.createContainerIfNotExists(o,n),t.promise},exports.createBlockBlobFromText=function(e,o,r,t,n){var c=q.defer(),l=function(e,o,r){if(e)c.reject(Error(e));else{var t={blockBlob:o,response:r};c.resolve(t)}},i=function(e){n?e.createBlockBlobFromText(o,r,t,n,l):e.createBlockBlobFromText(o,r,t,l)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.blobText,n=e.options,defaultBlobService().createContainerIfNotExists(o,{publicAccessLevel:"blob"},function(){i(defaultBlobService())})):i(e),c.promise},exports.createBlockBlobFromFile=function(e,o,r,t,n){var c=q.defer(),l=function(e,o,r){if(e)c.reject(Error(e));else{var t={blockBlob:o,response:r};c.resolve(t)}},i=function(e){n?e.createBlockBlobFromFile(o,r,t,n,l):e.createBlockBlobFromFile(o,r,t,l)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.fileName,n=e.options,exports.createContainerIfNotExists(defaultBlobService(),o,{publicAccessLevel:"blob"}).then(function(){i(defaultBlobService())})):i(e),c.promise},exports.createBlockBlobFromStream=function(e,o,r,t,n,c){var l=q.defer(),i=function(e,o,r){if(e)l.reject(Error(e));else{var t={blockBlob:o,response:r};l.resolve(t)}},a=function(e){c?e.createBlockBlobFromStream(o,r,t,n,c,i):e.createBlockBlobFromStream(o,r,t,n,i)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.stream,n=e.streamLength,c=e.options,exports.createContainerIfNotExists(defaultBlobService(),o,{publicAccessLevel:"blob"}).then(function(){a(defaultBlobService())})):a(e),l.promise},exports.deleteContainer=function(e,o,r){var t=q.defer(),n=function(e,o){e?t.reject(Error(e)):t.resolve(o)};return r?e.deleteContainer(o,r,n):e.deleteContainer(o,n),t.promise},exports.getBlobToText=function(e,o,r,t){var n=q.defer(),c=function(e,o,r,t){if(e)n.reject(Error(e));else{var c={text:o,blockBlob:r,response:t};n.resolve(c)}},l=function(e){t?e.getBlobToText(o,r,t,c):e.getBlobToText(o,r,c)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.options,defaultBlobService().createContainerIfNotExists(o,{publicAccessLevel:"blob"},function(){l(defaultBlobService())})):l(e),n.promise},exports.getBlobToFile=function(e,o,r,t,n){var c=q.defer(),l=function(e,o,r){if(e)c.reject(Error(e));else{var t={blockBlob:o,response:r};c.resolve(t)}},i=function(e){n?e.getBlobToFile(o,r,t,n,l):e.getBlobToFile(o,r,t,l)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.fileName,n=e.options,exports.createContainerIfNotExists(defaultBlobService(),o,{publicAccessLevel:"blob"}).then(function(){i(defaultBlobService())})):i(e),c.promise},exports.getBlobToStream=function(e,o,r,t,n){var c=q.defer(),l=function(e,o,r){if(e)c.reject(Error(e));else{var t={blockBlob:o,response:r};c.resolve(t)}},i=function(e){n?e.getBlobToStream(o,r,t,n,l):e.getBlobToStream(o,r,t,l)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.writeStream,n=e.options,exports.createContainerIfNotExists(defaultBlobService(),o,{publicAccessLevel:"blob"}).then(function(){i(defaultBlobService())})):i(e),c.promise},exports.deleteBlob=function(e,o,r,t){var n=q.defer(),c=function(e,o,r){if(e)n.reject(Error(e));else{var t={isSuccessful:o,response:r};n.resolve(t)}},l=function(e){t?e.deleteBlob(o,r,t,c):e.deleteBlob(o,r,c)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.options,exports.createContainerIfNotExists(defaultBlobService(),o,{publicAccessLevel:"blob"}).then(function(){l(defaultBlobService())})):l(e),n.promise},module.exports=exports;