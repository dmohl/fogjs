var q=require("q"),azure=require("azure"),exports={},defaultBlobService=azure.createBlobService();exports.createContainerIfNotExists=function(e,o,r){var t=q.defer(),n=function(e,o,r){if(e)t.reject(Error(e));else{var n={containerCreated:o,response:r};t.resolve(n)}};return r?e.createContainerIfNotExists(o,r,n):e.createContainerIfNotExists(o,n),t.promise},exports.createBlockBlobFromText=function(e,o,r,t,n){var l=q.defer(),c=function(e,o,r){if(e)l.reject(Error(e));else{var t={blockBlob:o,response:r};l.resolve(t)}},i=function(e){n?e.createBlockBlobFromText(o,r,t,n,c):e.createBlockBlobFromText(o,r,t,c)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.blobText,n=e.options,defaultBlobService.createContainerIfNotExists(o,{publicAccessLevel:"blob"},function(){i(defaultBlobService)})):i(e),l.promise},exports.createBlockBlobFromFile=function(e,o,r,t,n){var l=q.defer(),c=function(e,o,r){if(e)l.reject(Error(e));else{var t={blockBlob:o,response:r};l.resolve(t)}},i=function(e){n?e.createBlockBlobFromFile(o,r,t,n,c):e.createBlockBlobFromFile(o,r,t,c)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.fileName,n=e.options,exports.createContainerIfNotExists(defaultBlobService,o,{publicAccessLevel:"blob"}).then(function(){i(defaultBlobService)})):i(e),l.promise},exports.createBlockBlobFromStream=function(e,o,r,t,n,l){var c=q.defer(),i=function(e,o,r){if(e)c.reject(Error(e));else{var t={blockBlob:o,response:r};c.resolve(t)}},a=function(e){l?e.createBlockBlobFromStream(o,r,t,n,l,i):e.createBlockBlobFromStream(o,r,t,n,i)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.stream,n=e.streamLength,l=e.options,exports.createContainerIfNotExists(defaultBlobService,o,{publicAccessLevel:"blob"}).then(function(){a(defaultBlobService)})):a(e),c.promise},exports.deleteContainer=function(e,o,r){var t=q.defer(),n=function(e,o){e?t.reject(Error(e)):t.resolve(o)};return r?e.deleteContainer(o,r,n):e.deleteContainer(o,n),t.promise},exports.getBlobToText=function(e,o,r,t){var n=q.defer(),l=function(e,o,r,t){if(e)n.reject(Error(e));else{var l={text:o,blockBlob:r,response:t};n.resolve(l)}},c=function(e){t?e.getBlobToText(o,r,t,l):e.getBlobToText(o,r,l)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.options,defaultBlobService.createContainerIfNotExists(o,{publicAccessLevel:"blob"},function(){c(defaultBlobService)})):c(e),n.promise},exports.getBlobToFile=function(e,o,r,t,n){var l=q.defer(),c=function(e,o,r){if(e)l.reject(Error(e));else{var t={blockBlob:o,response:r};l.resolve(t)}},i=function(e){n?e.getBlobToFile(o,r,t,n,c):e.getBlobToFile(o,r,t,c)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.fileName,n=e.options,exports.createContainerIfNotExists(defaultBlobService,o,{publicAccessLevel:"blob"}).then(function(){i(defaultBlobService)})):i(e),l.promise},exports.getBlobToStream=function(e,o,r,t,n){var l=q.defer(),c=function(e,o,r){if(e)l.reject(Error(e));else{var t={blockBlob:o,response:r};l.resolve(t)}},i=function(e){n?e.getBlobToStream(o,r,t,n,c):e.getBlobToStream(o,r,t,c)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.writeStream,n=e.options,exports.createContainerIfNotExists(defaultBlobService,o,{publicAccessLevel:"blob"}).then(function(){i(defaultBlobService)})):i(e),l.promise},exports.deleteBlob=function(e,o,r,t){var n=q.defer(),l=function(e,o,r){if(e)n.reject(Error(e));else{var t={isSuccessful:o,response:r};n.resolve(t)}},c=function(e){t?e.deleteBlob(o,r,t,l):e.deleteBlob(o,r,l)};return e&&e.containerName?(o=e.containerName,r=e.blobName,t=e.options,exports.createContainerIfNotExists(defaultBlobService,o,{publicAccessLevel:"blob"}).then(function(){c(defaultBlobService)})):c(e),n.promise},module.exports=exports;